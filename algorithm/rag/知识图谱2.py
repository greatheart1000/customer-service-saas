#coding:utf-8

prompt="""## 角色
你是一个知识图谱工程专家，非常擅长从文本中精确抽取知识图谱的实体（主体、客体）和关系，并能对实体和关系的含义做出恰当的总结性描述。

## 技能
### 技能 1: 实体抽取
--请按照如下步骤抽取实体--
1. 准确地识别文本中的实体信息，一般是名词、代词等。
2. 准确地识别实体的修饰性描述，一般作为定语对实体特征做补充。
3. 对相同概念的实体（同义词、别称、代指），请合并为单一简洁的实体名，并合并它们的描述信息。
4. 对合并后的实体描述信息做简洁、恰当、连贯的总结。

### 技能 2: 关系抽取
--请按照如下步骤抽取关系--
1. 准确地识别文本中实体之间的关联信息，一般是动词、代词等。
2. 准确地识别关系的修饰性描述，一般作为状语对关系特征做补充。
3. 对相同概念的关系（同义词、别称、代指），请合并为单一简洁的关系名，并合并它们的描述信息。
4. 对合并后的关系描述信息做简洁、恰当、连贯的总结。

### 技能 3: 关联上下文
- 关联上下文来自与当前待抽取文本相关的前置段落内容，可以为知识抽取提供信息补充。
- 合理利用提供的上下文信息，知识抽取过程中出现的内容引用可能来自关联上下文。
- 不要对关联上下文的内容做知识抽取，而仅作为关联信息参考。
- 关联上下文是可选信息，可能为空。

## 约束条件
- 如果文本已提供了图结构格式的数据，直接转换为输出格式返回，不要修改实体或ID名称。- 尽可能多的生成文本中提及的实体和关系信息，但不要随意创造不存在的实体和关系。
- 确保以第三人称书写，从客观角度描述实体名称、关系名称，以及他们的总结性描述。
- 尽可能多地使用关联上下文中的信息丰富实体和关系的内容，这非常重要。
- 如果实体或关系的总结描述为空，不提供总结描述信息，不要生成无关的描述信息。
- 如果提供的描述信息相互矛盾，请解决矛盾并提供一个单一、连贯的描述。
- 实体和关系的名称或者描述文本出现#和:字符时，使用`_`字符替换，其他字符不要修改。
- 避免使用停用词和过于常见的词汇。

## 输出格式
Entities:
(实体名#实体总结)
...

Relationships:
(来源实体名#关系名#目标实体名#关系总结)
...

## 参考案例
--案例仅帮助你理解提示词的输入和输出格式，请不要在答案中使用它们。--
输入:
```
[上下文]:
Section 1:
菲尔・贾伯的大儿子叫雅各布・贾伯。
Section 2:
菲尔・贾伯的小儿子叫比尔・贾伯。
...
[文本]:
菲尔兹咖啡由菲尔・贾伯于1978年在加利福尼亚州伯克利创立。因其独特的混合咖啡而闻名，菲尔兹已扩展到美国多地。他的大儿子于2005年成为首席执行官，并带领公司实现了显著增长。
```

输出:
```
Entities:
(菲尔・贾伯#菲尔兹咖啡创始人)
(菲尔兹咖啡#加利福尼亚州伯克利创立的咖啡品牌)
(雅各布・贾伯#菲尔・贾伯的大儿子)
(美国多地#菲尔兹咖啡的扩展地区)

Relationships:
(菲尔・贾伯#创建#菲尔兹咖啡#1978年在加利福尼亚州伯克利创立)
(菲尔兹咖啡#位于#加利福尼亚州伯克利#菲尔兹咖啡的创立地点)
(菲尔・贾伯#拥有#雅各布・贾伯#菲尔・贾伯的大儿子)
(雅各布・贾伯#管理#菲尔兹咖啡#在2005年担任首席执行官)
(菲尔兹咖啡#扩展至#美国多地#菲尔兹咖啡的扩展范围)
```

----

请根据接下来[上下文]提供的信息，按照上述要求，抽取[文本]中的实体和关系数据。

[上下文]:
{history}

[文本]:
{text}

[结果]:


"""

import json
import sys
import requests
from utils import prepare_request
from utils import ak,sk

method = 'POST'
DOMAIN = "api-knowledgebase.mlp.cn-beijing.volces.com"
path = '/api/knowledge/chat/completions'

query="""字节大模型外包岗位职位序列：图像算法训练师、数据标注专员——随着大模型的发展，对人选的技术能力要求可能会发生哪些变化？如何提前准备？
随着大模型的不断发展，技术能力要求可能会发生以下变化：

1. 对图像算法训练师的要求变化：
更强的多模态能力：未来将要求图像算法训练师具备处理多模态数据的能力，不仅是图像，还包括图像与文本、语音等的融合。
深度学习框架的掌握：对如PyTorch、TensorFlow等框架的掌握会变得更加重要，特别是对模型的调优和优化。
预训练模型的使用与微调：未来可能更多地依赖预训练的视觉模型（如ViT、CLIP），要求训练师具备如何微调这些大模型的能力。
2. 对数据标注专员的要求变化：
高质量数据标注：随着大模型的发展，数据标注的质量要求会越来越高，标注专员需要具备一定的领域知识，以便提供更精准的标注。
自动化标注工具的使用：未来可能会更多使用自动化标注工具，标注专员需要学习如何与这些工具配合工作，提高标注效率。
提前准备的方向：
强化深度学习知识：无论是图像算法训练师还是数据标注专员，未来都需要更深的机器学习/深度学习知识。
掌握多模态技术：随着多模态AI的发展，掌握如何处理、融合多种数据（图像、语音、文本）将成为重要的技术能力。
提升自动化标注工具的使用能力：学习如何使用数据标注中的自动化工具，如Active Learning、半自动标注等，将有助于提高工作效率。"""

input = prompt.replace('{history}'," ").replace('{text}',query)

request_params = {
    "model": "Doubao-lite-4k",
    "max_tokens": 4096,
    "temperature": 0.1,
    "messages": [
        {"role": "system", "content": "你是一个智能助手。"},
        {"role": "user", "content": "你好"},
        {"role": "assistant", "content": "你好！有什么我可以帮助你的？"},
        {"role": "user", "content": input},
    ],
    "stream": False,
    "return_token_usage": True
}
info_req = prepare_request(method = method, path = path, ak = ak, sk = sk,
                           data = request_params)
res = requests.request(method=info_req.method,
                url = "https://{}{}".format(DOMAIN, info_req.path),
                headers = info_req.headers,
                data = info_req.body)
print(res.json()['data']['generated_answer'])



summaries_prompt="""
## 角色
你非常擅长知识图谱的信息总结，能根据给定的知识图谱中的实体和关系的名称以及描述信息，全面、恰当地对知识图谱子图信息做出总结性描述，并且不会丢失关键的信息。

## 技能
### 技能 1: 实体识别
- 准确地识别[Entities:]章节中的实体信息，包括实体名、实体描述信息。
- 实体信息的一般格式有:
(实体名)
(实体名:实体描述)
(实体名:实体属性表)

### 技能 2: 关系识别
- 准确地识别[Relationships:]章节中的关系信息，包括来源实体名、关系名、目标实体名、关系描述信息，实体名也可能是文档ID、目录ID、文本块ID。
- 关系信息的一般格式有:
(来源实体名)-[关系名]->(目标实体名)
(来源实体名)-[关系名:关系描述]->(目标实体名)
(来源实体名)-[关系名:关系属性表]->(目标实体名)

### 技能 3: 图结构理解
--请按照如下步骤理解图结构--
1. 正确地将关系信息中的来源实体名与实体信息关联。
2. 正确地将关系信息中的目标实体名与实体信息关联。
3. 根据提供的关系信息还原出图结构。

### 技能 4: 知识图谱总结
--请按照如下步骤总结知识图谱--
1. 确定知识图谱表达的主题或话题，突出关键实体和关系。
2. 使用准确、恰当、简洁的语言总结图结构表达的信息，不要生成与图结构中无关的信息。

## 约束条件
- 不要在答案中描述你的思考过程，直接给出用户问题的答案，不要生成无关信息。
- 确保以第三人称书写，从客观角度对知识图谱表达的信息进行总结性描述。
- 如果实体或关系的描述信息为空，对最终的总结信息没有贡献，不要生成无关信息。
- 如果提供的描述信息相互矛盾，请解决矛盾并提供一个单一、连贯的描述。
- 避免使用停用词和过于常见的词汇。

## 参考案例
--案例仅帮助你理解提示词的输入和输出格式，请不要在答案中使用它们。--
输入:
```
Entities:
(菲尔・贾伯#菲尔兹咖啡创始人)
(菲尔兹咖啡#加利福尼亚州伯克利创立的咖啡品牌)
(雅各布・贾伯#菲尔・贾伯的儿子)
(美国多地#菲尔兹咖啡的扩展地区)

Relationships:
(菲尔・贾伯#创建#菲尔兹咖啡#1978年在加利福尼亚州伯克利创立)
(菲尔兹咖啡#位于#加利福尼亚州伯克利#菲尔兹咖啡的创立地点)
(菲尔・贾伯#拥有#雅各布・贾伯#菲尔・贾伯的儿子)
(雅各布・贾伯#担任#首席执行官#在2005年成为菲尔兹咖啡的首席执行官)
(菲尔兹咖啡#扩展至#美国多地#菲尔兹咖啡的扩展范围)
```

输出:
```
菲尔兹咖啡是由菲尔・贾伯在1978年于加利福尼亚州伯克利创立的咖啡品牌。菲尔・贾伯的儿子雅各布・贾伯在2005年接任首席执行官，领导公司扩展到了美国多地，进一步巩固了菲尔兹咖啡作为加利福尼亚州伯克利创立的咖啡品牌的市场地位。
```

----

请根据接下来[知识图谱]提供的信息，按照上述要求，总结知识图谱表达的信息。

[知识图谱]:
{graph}

[总结]:



"""

graph ="""Entities:
(字节大模型#人工智能模型)
(图像算法训练师#人工智能领域的专业人员)
(数据标注专员#人工智能领域的专业人员)
(多模态能力#人工智能领域的技术能力)
(深度学习框架#人工智能领域的技术能力)
(预训练模型#人工智能领域的技术能力)
(ViT#人工智能领域的技术能力)
(CLIP#人工智能领域的技术能力)
(高质量数据标注#人工智能领域的数据处理技术)
(自动化标注工具#人工智能领域的数据处理技术)

Relationships:
(字节大模型#包含#图像算法训练师)
(字节大模型#包含#数据标注专员)
(图像算法训练师#需要具备#多模态能力)
(图像算法训练师#需要具备#深度学习框架的掌握能力)
(图像算法训练师#需要具备#预训练模型的使用与微调能力)
(数据标注专员#需要具备#高质量数据标注能力)
(数据标注专员#需要具备#自动化标注工具的使用能力)
(字节大模型#发展要求#图像算法训练师强化深度学习知识)
(字节大模型#发展要求#数据标注专员掌握多模态技术)
(字节大模型#发展要求#图像算法训练师提升自动化标注工具的使用能力)
(字节大模型#发展要求#数据标注专员提升自动化标注工具的使用能力)"""

input = summaries_prompt.replace('{graph}',graph)

request_params = {
    "model": "Doubao-lite-4k",
    "max_tokens": 4096,
    "temperature": 0.1,
    "messages": [
        {"role": "system", "content": "你是一个智能助手。"},
        {"role": "user", "content": "你好"},
        {"role": "assistant", "content": "你好！有什么我可以帮助你的？"},
        {"role": "user", "content": input},
    ],
    "stream": False,
    "return_token_usage": True
}
info_req = prepare_request(method = method, path = path, ak = ak, sk = sk,
                           data = request_params)
res = requests.request(method=info_req.method,
                url = "https://{}{}".format(DOMAIN, info_req.path),
                headers = info_req.headers,
                data = info_req.body)
print(res.json()['data']['generated_answer'])
