# ğŸš€ å¿«é€Ÿå¼€å§‹ - æ™ºèƒ½å®¢æœ SaaS ç³»ç»Ÿ

## âœ¨ æœ€æ–°åŠŸèƒ½ (v1.0)

### âœ… ç®€åŒ–ç‰ˆ RBAC æƒé™ç³»ç»Ÿ
- **3 ç§è§’è‰²**ï¼šå¹³å°ç®¡ç†å‘˜ã€ç»„ç»‡ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·
- **è·¯ç”±å®ˆå«**ï¼šå‰ç«¯å’Œåç«¯åŒé‡æƒé™éªŒè¯
- **æ•°æ®åº“è¿ç§»**ï¼š`001_add_user_roles.py`

### âœ… Coze API çœŸå® AI å¯¹è¯
- **æµå¼å“åº”**ï¼šSSE å®æ—¶æ¨é€ AI å›å¤
- **å¤šæœºå™¨äººæ”¯æŒ**ï¼šå¯åˆ‡æ¢ä¸åŒæœºå™¨äºº
- **æ¶ˆæ¯å†å²**ï¼šè‡ªåŠ¨ä¿å­˜å¯¹è¯è®°å½•
- **ä¼˜é›…é™çº§**ï¼šAPI å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

### âœ… å®Œæ•´ç®¡ç†ç«¯
- **ä»ªè¡¨æ¿**ï¼šæ•°æ®ç»Ÿè®¡å’Œå›¾è¡¨
- **ç”¨æˆ·ç®¡ç†**ï¼šç”¨æˆ·åˆ—è¡¨ã€è§’è‰²ç®¡ç†
- **æœºå™¨äººç®¡ç†**ï¼šåˆ›å»ºå’Œç®¡ç† Coze æœºå™¨äºº
- **çŸ¥è¯†åº“ç®¡ç†**ï¼šæ–‡æ¡£ç®¡ç†å’Œå¯¼å…¥
- **å¯¹è¯ç®¡ç†**ï¼šæŸ¥çœ‹æ‰€æœ‰å¯¹è¯è®°å½•

---

## ä¸€é”®å¯åŠ¨

### Linux / macOS
```bash
./start.sh
```

### Windows
```cmd
start.bat
```

## æ‰‹åŠ¨å¯åŠ¨

### 1. åç«¯æœåŠ¡

```bash
cd saas_backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆ›å»ºé…ç½®æ–‡ä»¶
cp .env.example .env

# å¯åŠ¨åç«¯
python -m app.main
```

åç«¯è¿è¡Œåœ¨: **http://localhost:8000**

### 2. å‰ç«¯æœåŠ¡

```bash
cd saas_frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å‰ç«¯
npm run dev
```

å‰ç«¯è¿è¡Œåœ¨: **http://localhost:3000**

## æµ‹è¯•åŠŸèƒ½

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test_setup.sh

# æˆ–æ‰‹åŠ¨æµ‹è¯•
curl http://localhost:8000/health
```

## åœæ­¢æœåŠ¡

### Linux / macOS
```bash
./stop.sh
```

### Windows
```cmd
stop.bat
```

## è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ |
|------|------|
| ğŸ¨ å‰ç«¯ç•Œé¢ | http://localhost:3000 |
| ğŸ”§ åç«¯ API | http://localhost:8000 |
| ğŸ“š API æ–‡æ¡£ | http://localhost:8000/docs |
| ğŸ“– ReDoc | http://localhost:8000/redoc |

## é¦–æ¬¡è¿è¡Œ

1. **å®‰è£… PostgreSQL**
   ```bash
   # Ubuntu/Debian
   sudo apt install postgresql

   # macOS
   brew install postgresql

   # å¯åŠ¨ PostgreSQL
   sudo systemctl start postgresql
   ```

2. **åˆ›å»ºæ•°æ®åº“**
   ```bash
   sudo -u postgres psql
   CREATE DATABASE saas_customer_service;
   \q
   ```

3. **è¿è¡Œæ•°æ®åº“è¿ç§»**ï¼ˆå¿…éœ€ï¼‰
   ```bash
   cd saas_backend
   alembic upgrade head
   ```

   è¿™å°†åˆ›å»ºï¼š
   - ç”¨æˆ·è§’è‰²å­—æ®µ (`is_admin`, `is_org_admin`)
   - æ¶ˆæ¯è¡¨ (`messages`)

4. **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·**
   ```bash
   python create_admin.py
   ```

   æˆ–ç›´æ¥åœ¨æ•°æ®åº“ä¸­è®¾ç½®ï¼š
   ```sql
   UPDATE users SET is_admin=true, is_org_admin=true WHERE email='your@email.com';
   ```

## æµ‹è¯•ç™»å½•

### é‚®ç®±ç™»å½•
1. è®¿é—® http://localhost:3000/login
2. åˆ‡æ¢åˆ°"é‚®ç®±ç™»å½•"æ ‡ç­¾
3. è¾“å…¥é‚®ç®±å’Œå¯†ç 
4. ç‚¹å‡»"ç™»å½•"

### æ‰‹æœºç™»å½•
1. åˆ‡æ¢åˆ°"æ‰‹æœºç™»å½•"æ ‡ç­¾
2. è¾“å…¥æ‰‹æœºå·ï¼ˆå¦‚ï¼š13800138000ï¼‰
3. ç‚¹å‡»"å‘é€"è·å–éªŒè¯ç 
4. å¼€å‘ç¯å¢ƒä¼šæ˜¾ç¤ºéªŒè¯ç 
5. è¾“å…¥éªŒè¯ç å¹¶ç™»å½•

### å¾®ä¿¡ç™»å½•
1. åˆ‡æ¢åˆ°"å¾®ä¿¡ç™»å½•"æ ‡ç­¾
2. ç‚¹å‡»"ç”Ÿæˆå¾®ä¿¡ç™»å½•äºŒç»´ç "
3. ä½¿ç”¨å¾®ä¿¡æ‰«ç ï¼ˆéœ€è¦é…ç½®å¾®ä¿¡ï¼‰

## å¸¸è§é—®é¢˜

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥æ‰¾å¹¶æ€æ­»å ç”¨ 8000 ç«¯å£çš„è¿›ç¨‹
lsof -ti:8000 | xargs kill -9

# æŸ¥æ‰¾å¹¶æ€æ­»å ç”¨ 3000 ç«¯å£çš„è¿›ç¨‹
lsof -ti:3000 | xargs kill -9
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
sudo systemctl status postgresql

# å¯åŠ¨ PostgreSQL
sudo systemctl start postgresql
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
tail -f backend.log

# å‰ç«¯æ—¥å¿—
tail -f frontend.log
```

## ä¸‹ä¸€æ­¥

- é…ç½®çœŸå®çŸ­ä¿¡æœåŠ¡ï¼šç¼–è¾‘ `.env` æ–‡ä»¶ä¸­çš„çŸ­ä¿¡é…ç½®
- é…ç½®å¾®ä¿¡ç™»å½•ï¼šåœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·åº”ç”¨
- é…ç½®æ”¯ä»˜åŠŸèƒ½ï¼šé…ç½®å¾®ä¿¡æ”¯ä»˜æˆ–æ”¯ä»˜å®
- ç”Ÿäº§éƒ¨ç½²ï¼šæŸ¥çœ‹ [DEPLOYMENT.md](./DEPLOYMENT.md)

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·ç«¯åŠŸèƒ½

1. **èŠå¤©å¯¹è¯** (`/chat`)
   - å®æ—¶æµå¼ AI å¯¹è¯
   - æ”¯æŒå¤šæœºå™¨äººåˆ‡æ¢
   - è‡ªåŠ¨ä¿å­˜å†å²è®°å½•

2. **å†å²è®°å½•** (`/history`)
   - æŸ¥çœ‹æ‰€æœ‰å¯¹è¯è®°å½•
   - æœç´¢å’Œç­›é€‰

3. **ä¸ªäººä¸­å¿ƒ** (`/profile`)
   - æŸ¥çœ‹ä¸ªäººä¿¡æ¯
   - ç»Ÿè®¡æ•°æ®
   - è®¢é˜…çŠ¶æ€

### ç®¡ç†ç«¯åŠŸèƒ½ (`/admin/*`)

1. **ä»ªè¡¨æ¿** (`/admin/dashboard`)
   - ç”¨æˆ·ç»Ÿè®¡
   - å¯¹è¯ç»Ÿè®¡
   - æ”¶å…¥ç»Ÿè®¡

2. **ç”¨æˆ·ç®¡ç†** (`/admin/users`)
   - ç”¨æˆ·åˆ—è¡¨
   - è§’è‰²ç®¡ç†
   - æƒé™è®¾ç½®

3. **æœºå™¨äººç®¡ç†** (`/admin/bots`)
   - åˆ›å»º Coze æœºå™¨äºº
   - é…ç½®æ¬¢è¿æ¶ˆæ¯
   - å¯ç”¨/åœç”¨æœºå™¨äºº

4. **çŸ¥è¯†åº“ç®¡ç†** (`/admin/knowledge`)
   - åˆ›å»ºçŸ¥è¯†åº“
   - æ·»åŠ æ–‡æ¡£
   - å¯¼å…¥è®°å½•

5. **å¯¹è¯ç®¡ç†** (`/admin/conversations`)
   - æŸ¥çœ‹æ‰€æœ‰å¯¹è¯
   - æ¶ˆæ¯è¯¦æƒ…
   - å¯¼å‡ºè®°å½•

### æƒé™è¯´æ˜

| è§’è‰² | ç”¨æˆ·ç«¯ | ç®¡ç†ç«¯ | è¯´æ˜ |
|------|--------|--------|------|
| **å¹³å°ç®¡ç†å‘˜** | âœ… | âœ… | å…¨éƒ¨åŠŸèƒ½ |
| **ç»„ç»‡ç®¡ç†å‘˜** | âœ… | âœ… | ç®¡ç†æœ¬ç»„ç»‡ |
| **æ™®é€šç”¨æˆ·** | âœ… | âŒ | ä»…èŠå¤©åŠŸèƒ½ |

---

## ğŸ”§ Coze API é…ç½®

ç³»ç»Ÿå·²é›†æˆ Coze APIï¼Œé…ç½®æ–‡ä»¶ä½äº `.env`ï¼š

```env
COZE_API_TOKEN=pat_fHoypKwkf2V9XkOJdrsZlqrImJhPKXMRRb9gYoGptbPtyOASQtJpoPlnv5Ry4J4m
COZE_API_BASE=https://api.coze.cn
COZE_WORKSPACE_ID=7402890147165339699
COZE_BOT_ID=7482601981945839670
```

### è·å– Bot ID

1. è®¿é—® [Coze å¼€å‘å¹³å°](https://www.coze.cn)
2. åˆ›å»ºæˆ–é€‰æ‹©ç°æœ‰æœºå™¨äºº
3. å¤åˆ¶ Bot ID
4. åœ¨ç®¡ç†ç«¯ `/admin/bots` æ·»åŠ æœºå™¨äºº

---

## ğŸ“ å¼€å‘è¯´æ˜

### å‰ç«¯ API æœåŠ¡

```typescript
import { getBots, sendMessageStream } from './services/chat';

// è·å–æœºå™¨äººåˆ—è¡¨
const bots = await getBots();

// å‘é€æµå¼æ¶ˆæ¯
await sendMessageStream(
  { bot_id: 'xxx', message: 'ä½ å¥½' },
  onChunk,
  onError,
  onComplete
);
```

### åç«¯ API ç«¯ç‚¹

- **è®¤è¯**ï¼š`/api/v1/auth/*`
- **ç”¨æˆ·**ï¼š`/api/v1/auth/me`
- **èŠå¤©**ï¼š`/api/v1/chat/chat` (éæµå¼), `/api/v1/chat/chat/stream` (æµå¼)
- **æœºå™¨äºº**ï¼š`/api/v1/bots/*`
- **å¯¹è¯**ï¼š`/api/v1/conversations/*`
- **ç®¡ç†ç«¯**ï¼š`/api/v1/admin/*`

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: ç™»å½•åæ— æ³•è®¿é—®ç®¡ç†ç«¯ï¼Ÿ
**A**: è®¾ç½®ç”¨æˆ·æƒé™ï¼š
```sql
UPDATE users SET is_admin=true WHERE email='your@email.com';
```

### Q: èŠå¤©æ²¡æœ‰å“åº”ï¼Ÿ
**A**: æ£€æŸ¥ï¼š
1. `.env` ä¸­çš„ `COZE_API_TOKEN` æ˜¯å¦æ­£ç¡®
2. æœºå™¨äººæ˜¯å¦å·²åˆ›å»ºä¸” `is_active=True`
3. æŸ¥çœ‹åç«¯æ—¥å¿—

### Q: æµå¼èŠå¤©ä¸­æ–­ï¼Ÿ
**A**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤é˜²ç«å¢™å…è®¸ SSE
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

---

**è¯¦ç»†æ–‡æ¡£**: [RUN_GUIDE.md](./RUN_GUIDE.md)
